@use "sass:color";

@import "../../../scss/utilities/bootstrap-integration.scss";
@import "../../../scss/utilities/fontawesome-integration.scss";

// THIS IS A COMPLEX COMPONENT, BUT DON'T DESPAIR

// I decided not to break this one into smaller components
// because the contents of the header don't really repeat elsewhere
// in the page and it would mean making things more complex

// The hierarchy of the markup produced by Drupal is:
// header.page-header
// -- .page-header__branding
// -- -- .region-branding
// -- -- -- .block-system-branding-block
// -- -- -- -- a.site-logo
// -- -- -- -- -- img
// -- .page-header__navigation
// -- -- .navbar.navbar--secondary
// -- -- -- .region-secondary-menu
// -- -- -- -- .menu--account (Drupal menu)
// -- -- -- -- .menu--secondary-navigation (Drupal menu, social networks)
// -- -- .navbar.navbar--primary
// -- -- -- .region-primary-menu
// -- -- -- -- .menu--main (Drupal menu)
// -- -- -- -- [language switch and search button will be here eventually]

.page-header {

  // Local variables
  // ******************************************

  --social-media-icons-size: 1.25em;
  --main-menu-link-spacing-x: 2em; // the horizontal space between first-level main menu links
  --main-menu-active-border-weight: 4px; // the weight of the border that underlines active items
  --main-menu-border-radius: 3px; // The border radius of the submenu container and the top-level menu links when open
  --main-menu-caret-icon-size: 1em;
  --main-menu-submenu-min-width: 200px;
  --main-menu-submenu-shadow-blur: 5px;

  @include make-container();
  max-width: var(--container-width-wide);
  z-index: 1;

  display: flex;
  align-items: top;
  justify-content: start;
  padding: 1rem 0;

  position:relative; // allow nav toggler to use absolute positioning

  .page-header__branding {
    height: var(--header-height);

    .region-branding,
    .region-branding .block-system-branding-block {
      height: 100%;
    }

    .block-system-branding-block img {
      max-height: 100%;
      width: auto;
      max-width: 100%;
    }
  }

  .page-header__navigation {
    flex-grow: 1;

    .region-primary-menu,
    .region-secondary-menu {
      display: flex;
      align-items: center;
      justify-content: end;
      height: calc(var(--header-height) / 2);

      // Resets that apply to all menus
      // ******************************************
      ul.menu {
        display: flex;
        align-items: center;
        justify-content: end;
        margin: 0;
        padding: 0;

        li.menu-item {
          margin-left: 1em;
          list-style-type: none;
          list-style-image: none;
          padding: 0;
          margin: 0;
          margin-left: 1em;

          a {
            color: var(--color-text-foreground);
            text-decoration: none;
            display: block;
            line-height: 100%; // make the links 1em in height to allow precise control of dimensions

            &:hover,
            &.is-active {
              text-decoration: underline;
              color: var(--color--text-foreground-light);
            }
          }

          // Hide the second-level menu by default
          > ul.menu {

            // Hide menu levels below this
            ul.menu {
              display: none;
            }
          }
        }
      }


      // User account menu
      // ******************************************

      // Social networks menu (secondary)
      // ******************************************
      .menu--secondary-navigation {

        li.menu-item {
          margin: 0 calc(var(--social-media-icons-size) / 2);

          a {
            @include fa-square-icon(1.25rem, var(--fa-style-family-brands));

            &.facebook:before {
              content: "\f082";
            }

            &.instagram:before {
              content: "\f16d";
            }

            &.twitter:before {
              content: "\f081";
            }

            &.linkedin:before {
              content: "\f08c";
            }

            &.mastodon:before {
              content: "\f4f6";
            }

            &.vimeo:before {
              content: "\f194";
            }

            &.youtube:before {
              content: "\f431";
            }
          }
        }
      }

      // Main menu
      // ******************************************
      .menu--main {
        flex-grow: 1;

        // First level items
        > ul.menu {
          > li.menu-item {
            padding: 0 calc(var(--main-menu-link-spacing-x) / 4);
            margin: 0 calc(var(--main-menu-link-spacing-x) / 4);
            border-top-left-radius: var(--main-menu-border-radius);
            border-top-right-radius: var(--main-menu-border-radius);
            color: var(--color-text-foreground-light);

            &:last-child {
              margin-right: calc(var(--main-menu-link-spacing-x) / 4 * -1);
            }

            > a {
              box-sizing: border-box;
              text-decoration: none;
              border-bottom: var(--main-menu-active-border-weight) solid transparent;
              padding: calc(var(--main-menu-link-spacing-x) / 4) 0;

              &.is-active {
                border-bottom-color: var(--color-accent-50);
              }
            }
          }

          // Second level menus
          > li.menu-item--expanded {

            cursor: pointer;

            // Make the parent item the frame of reference for the submenu
            position: relative;
            padding-right: calc(var(--main-menu-caret-icon-size) + (var(--main-menu-link-spacing-x) / 4));

            // Add the caret icon
            @include fa-icon-element(1em, var(--fa-style-family-classic));
            &:before {
              transition: transform 0.25s;
              position: absolute;
              right: calc(var(--main-menu-link-spacing-x) / 4);
              top: 50%;
              margin-top: calc(var(--main-menu-caret-icon-size) / 2 * -1);
              pointer-events: none;
              content: "\f0d7";
            }

            > ul.menu {
              display: block;
              position: absolute;
              right: 0;
              transition: opacity 0.25s, transform 0.15s;
              transform: translateY(-50px);
              opacity: 0;
              pointer-events: none;
              min-width: var(--main-menu-submenu-min-width);
              box-shadow: 0 0 var(--main-menu-submenu-shadow-blur) var(--color-primary-30);
              background-color: var(--color-text-background);
              border: 1px solid var(--color-primary-20);
              border-radius: var(--main-menu-border-radius);
              border-top-right-radius: 0;
              padding: calc(var(--main-menu-link-spacing-x) / 2);

              > li.menu-item {
                padding: calc(var(--main-menu-link-spacing-x) / 4);
                margin: calc(var(--main-menu-link-spacing-x) / 4);

                &:hover {
                  background-color: var(--color-primary-10);
                }

                &:first-child {
                  margin-top: 0;
                }

                &:last-child {
                  margin-bottom: 0;
                }
              }
            }
          }

          > li.menu-item--expanded.is-open {
            background-color: var(--color-primary-20);
            color: var(--color-text-foreground);

            &:before {
              transform: rotate(180deg);
            }

            > ul.menu {
              opacity: 1;
              transform: translateY(0);
              pointer-events: all;
            }
          }
        }
      }
    }
  }

  .page-header__navigation-toggler {
    position: absolute;
    top: 20px;
    right: 20px;

    @include fa-square-icon(1.25rem, var(--fa-style-family-classic));
    &:before {
      content: "\f0c9";
    }

    // Override the display set by fa-square-icon
    display: none;
  }

  // Add the debug class to the .page-header component to
  // see outlines and make layout style development easier
  &.debug {
    .region {
      outline: thin dotted red;
    }

    ul.menu {
      outline: thin dotted blue;
      background-color: rgba(0, 0, 255, .2);

      li.menu-item {
        outline: thin dotted green;
        background-color: rgba(0, 255, 0, .2);
      }
    }
  }
}
